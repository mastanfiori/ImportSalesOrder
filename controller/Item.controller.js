/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","cus/sd/salesorder/imports1/utils/formatter","cus/sd/salesorder/imports1/utils/commonEventHandler","cus/sd/salesorder/imports1/utils/utility","sap/m/ObjectStatus","sap/f/library","sap/base/util/deepExtend","sap/ui/core/Fragment","sap/ui/core/Item"],function(C,f,c,u,O,a,d,F,I){"use strict";return C.extend("cus.sd.salesorder.imports1.controller.Item",{formatter:f,commonEventHandler:c,oFiledList:{},bNoData:false,tempItemRuntimeColumns:[],onInit:function(){this.initialModels();var o=this.getOwnerComponent();this.oRouter=o.getRouter();this.oModel=o.getModel();this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oPreviewTable=this.byId("importItemTable");this.oColumnListItem=this.byId("importItemListItem");this.oDetailButton=this.byId("importItemDetailBtn");this.oEnterFSBtn=this.byId("enterOrExitFullScreenBtn");this.oPreviewView=this.getView();this.formatter.setResourceBundle(this.oResourceBundle);this.attachRouterEvent();this.sDataModelRootPath="importSalesOrder>";this.utility=new u(this,"Item");},initialModels:function(){this.oResourceBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oUIModel=this.getOwnerComponent().getModel("ui");this.oImportDataModel=this.getOwnerComponent().getModel("importSalesOrder");this.oP13nModel=this.getOwnerComponent().getModel("p13n");this.oMsgModel=this.getOwnerComponent().getModel("msgDialog");this.oModel=this.getOwnerComponent().getModel();},attachRouterEvent:function(){this.oRouter.attachRoutePatternMatched(this._onRouterPattenMatched,this);},_onRouterPattenMatched:function(e){var l=e.getParameters().arguments.layout;var o=this.byId("enterOrExitFullScreenBtn");var i=o.getIcon();var r=this.getView().getModel("i18n").getResourceBundle();if(l===a.LayoutType.MidColumnFullScreen){if(i==="sap-icon://full-screen"){o.setIcon("sap-icon://exit-full-screen");var E=r.getText("BUTTON_ITEM_TOOLTIP_EXITFULLSCREEN");o.setTooltip(E);this.oUIModel.setProperty("/actionButtonsInfo",2);}}if(l===a.LayoutType.TwoColumnsMidExpanded){if(i==="sap-icon://exit-full-screen"){o.setIcon("sap-icon://full-screen");var s=r.getText("BUTTON_ITEM_TOOLTIP_ENTERFULLSCREEN");o.setTooltip(s);this.oUIModel.setProperty("/actionButtonsInfo",1);}}if(e.getParameter("name")==="detail"){this.processItemData();this.aModelItemColumns=this.oP13nModel.getProperty("/itemRuntimeColumns");if(this.aModelItemColumns!==null&this.aModelItemColumns!==undefined){this.itemRuntimeColumns=d([],this.aModelItemColumns);this.onItemSettingOk();}else{this.buildTable();}}},processItemData:function(){var i=this.oImportDataModel.getProperty("/salesItemData");for(var b in i){var s=this.getStatus(i[b]);i[b].ItemStatus=s;}if(i&&i.length>0){this.oImportDataModel.setProperty("/salesItemData",i);this.bNoData=false;}else{this.bNoData=true;}},getStatus:function(s){for(var i in s){if(s[i]==="#Err01"){return"Error";}}return"None";},buildTable:function(s,S){if(this.bNoData){this.onDeclinePress();return;}this.oFiledList=this.oUIModel.getProperty("/fieldList");var D=this.getOwnerComponent().getModel("document");var k=D.getProperty("/keyField");if(!this.oFiledList[k]){this.onDeclinePress();return;}var i=this.oUIModel.getProperty("/itemFields");if(s!==undefined){i=s;}if(!i||i.length<=0){this.onDeclinePress();return;}this.utility.buildPreviewTable(s,S);this.oPreviewTable.bindItems({path:"importSalesOrder>/salesItemData",template:this.oColumnListItem});this.oEnterFSBtn.focus();},onDeclinePress:function(){this.oRouter.navTo("master",{layout:a.LayoutType.OneColumn},true);},onItemSettingDialogPress:function(){var p=sap.ui.xmlfragment("cus.sd.salesorder.imports1.view.fragment.SettingDialogForItem",this);p.setModel(this.oP13nModel);this.getView().addDependent(p);p.open();},onChangeColumnsItems:function(e){this.tempItemRuntimeColumns=e.getParameter("items");},onItemSettingOk:function(e){if(this.tempItemRuntimeColumns.length!==0){this.itemRuntimeColumns=d([],this.tempItemRuntimeColumns);this.tempItemRuntimeColumns.length=0;}var r=this.itemRuntimeColumns;var s=[];var S=[];for(var i in r){s.push(r[i].columnKey);if(r[i].visible===true){S.push(r[i].columnKey);}}this.utility.clearTable();this.buildTable(s,S);if(e){e.getSource().close();}this.oPreviewTable.firePopinChanged();},onItemSettingCancel:function(e){this.oP13nModel.setProperty("/itemRuntimeColumns",d([],this.itemRuntimeColumns));e.getSource().close();this.tempItemRuntimeColumns.length=0;},onHandleEnterOrExitFullScreen:function(e){var r=this.getView().getModel("i18n").getResourceBundle();var o=this.byId("enterOrExitFullScreenBtn");var i=o.getIcon();switch(i){case"sap-icon://exit-full-screen":o.setIcon("sap-icon://full-screen");var E=r.getText("BUTTON_ITEM_TOOLTIP_ENTERFULLSCREEN");o.setTooltip(E);this.oUIModel.setProperty("/actionButtonsInfo",1);this.oRouter.navTo("detail",{layout:a.LayoutType.TwoColumnsMidExpanded},false);break;case"sap-icon://full-screen":o.setIcon("sap-icon://exit-full-screen");var s=r.getText("BUTTON_ITEM_TOOLTIP_EXITFULLSCREEN");o.setTooltip(s);this.oUIModel.setProperty("/actionButtonsInfo",2);this.oRouter.navTo("detail",{layout:a.LayoutType.MidColumnFullScreen},false);break;default:break;}},onHandleFullScreen:function(e){this.oUIModel.setProperty("/actionButtonsInfo",2);this.oRouter.navTo("detail",{layout:a.LayoutType.MidColumnFullScreen},false);},onHandleExitFullScreen:function(e){this.oUIModel.setProperty("/actionButtonsInfo",1);this.oRouter.navTo("detail",{layout:a.LayoutType.TwoColumnsMidExpanded},false);}});});
