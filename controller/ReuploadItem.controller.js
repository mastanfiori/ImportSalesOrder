/*
 * Copyright (C) 2009-2022 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","cus/sd/salesorder/imports1/utils/formatter","cus/sd/salesorder/imports1/utils/utility","cus/sd/salesorder/imports1/utils/commonEventHandler","sap/base/util/deepExtend"],function(C,f,u,c,d){"use strict";return C.extend("cus.sd.salesorder.imports1.controller.ReuploadItem",{formatter:f,commonEventHandler:c,oFiledList:{},bNoData:false,tempItemRuntimeColumns:[],onInit:function(){this.oPreviewTable=this.byId("reuploadItemTable");this.oColumnListItem=this.byId("reuploadItemListItem");this.oDetailButton=this.byId("reuploadItemDetailBtn");this.utility=new u(this,"Item",true);this.sDataModelRootPath="reuploadSalesDoc>";var t=this;this.getView().attachAfterRendering(this._AfterViewRendering,t);},initialModels:function(){this.oResourceBundle=this.getView().getParent().getModel("i18n").getResourceBundle();this.oUIModel=this.getView().getParent().getModel("reuploadUi");this.oImportDataModel=this.getView().getParent().getModel("reuploadSalesDoc");this.oP13nModel=this.getView().getParent().getModel("reuploadP13n");this.oMsgModel=this.getView().getParent().getModel("reuploadMsgDialog");this.oModel=this.getView().getParent().getModel();},_AfterViewRendering:function(){if(!this.oReuploadNavContainer){this.initialModels();this.oPreviewView=this.getView();this.oReuploadNavContainer=this.getView().getParent().getParent();this.oResourceBundle=this.getView().getParent().getModel("i18n").getResourceBundle();var t=this;this.oReuploadNavContainer.attachAfterNavigate(this._onHeaderNavToItemPage,t);this.reuploadNavBackButton=this.getView().getParent().getParent().getParent().getCustomHeader().getContentLeft()[0];this.reuplpadDialogTitle=this.getView().getParent().getParent().getParent().getCustomHeader().getContentLeft()[1];}},_onHeaderNavToItemPage:function(e){if(e.getParameter("fromId").indexOf("header")!==-1){this.reuplpadDialogTitle.setText(this.oResourceBundle.getText("REUPLOAD_DIALOG_ITEM_TITLE"));this.reuploadNavBackButton.setVisible(true);this.processItemData();this.aModelItemColumns=this.oP13nModel.getProperty("/itemRuntimeColumns");if(this.aModelItemColumns!==null&this.aModelItemColumns!==undefined){this.itemRuntimeColumns=d([],this.aModelItemColumns);this.onItemSettingOk();}else{this.buildTable();}}},processItemData:function(){var i=this.oImportDataModel.getProperty("/salesItemData");for(var a in i){var s=this.getStatus(i[a]);i[a].ItemStatus=s;}if(i&&i.length>0){this.oImportDataModel.setProperty("/salesItemData",i);this.bNoData=false;}else{this.bNoData=true;}},getStatus:function(s){for(var i in s){if(s[i]==="#Err01"){return"Error";}}return"None";},buildTable:function(s,S){if(this.bNoData){this.onDeclinePress();return;}this.oFiledList=this.oUIModel.getProperty("/fieldList");var D=this.getView().getParent().getModel("document");var k=D.getProperty("/keyField");if(!this.oFiledList[k]){this.onDeclinePress();return;}var i=this.oUIModel.getProperty("/itemFields");if(s!==undefined){i=s;}if(!i||i.length<=0){this.onDeclinePress();return;}this.utility.buildPreviewTable(s,S);var b=this.sDataModelRootPath+"/salesItemData";this.oPreviewTable.bindItems({path:b,template:this.oColumnListItem});},onItemSettingDialogPress:function(){var p=sap.ui.xmlfragment("cus.sd.salesorder.imports1.view.fragment.SettingDialogForItem",this);p.setModel(this.oP13nModel);this.oPreviewView.addDependent(p);p.open();},onChangeColumnsItems:function(e){this.tempItemRuntimeColumns=e.getParameter("items");},onItemSettingOk:function(e){if(this.tempItemRuntimeColumns.length!==0){this.itemRuntimeColumns=d([],this.tempItemRuntimeColumns);this.tempItemRuntimeColumns.length=0;}var r=this.itemRuntimeColumns;var s=[];var S=[];for(var i in r){s.push(r[i].columnKey);if(r[i].visible===true){S.push(r[i].columnKey);}}this.utility.clearTable();this.buildTable(s,S);if(e){e.getSource().close();}this.oPreviewTable.firePopinChanged();},onItemSettingCancel:function(e){this.oP13nModel.setProperty("/itemRuntimeColumns",d([],this.itemRuntimeColumns));e.getSource().close();this.tempItemRuntimeColumns.length=0;},});});
